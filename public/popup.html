<!DOCTYPE html>
<html lang="jp ">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="title"></title>
  <link rel="stylesheet" href="popup.css" />
</head>

<body class="container-md pb-3 p-2" id="popup-body">
  <div id="header">
    <div class="d-flex justify-content-between align-items-center p-1">
      <div class="d-flex justify-content-center align-items-center">
        <img src="/icons/icon.png" class="my-auto mx-2" alt="message clear button" height="24" />
        <h1 class="my-auto fs-3" id="title-header"></h1>
      </div>
      <button type="button" class="btn btn-sm btn-light p-1 me-2" id="new-tab-button" aria-label="新しいタブで開く"
        title="新しいタブで開く">
        <i class="bi bi-box-arrow-up-right" style="font-size: 16px; line-height: 1"></i>
      </button>
    </div>
  </div>

  <!-- ステータスの表示 -->
  <div class="d-flex justify-content-between my-2 mx-1">
    <label class="my-auto" for="enabled" id="enabled-label"></label>
    <div class="form-check form-switch form-check-reverse me-3">
      <input class="form-check-input" type="checkbox" role="switch" id="enabled" />
    </div>
  </div>

  <!-- メニュータブ -->
  <ul class="nav nav-underline mb-2 mx-1" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <a class="nav-link p-1 p-md-2 active" id="settings-tab" data-bs-toggle="tab" href="#settings" role="tab"
        aria-controls="settings " aria-selected="true">設定</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link p-1 p-md-2" id="document-tab" data-bs-toggle="tab" href="#document" role="tab"
        aria-controls="document" aria-selected="false">ドキュメント</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link py-1 p-md-2" id="version-tab" data-bs-toggle="tab" href="#version" role="tab"
        aria-controls="version" aria-selected="true">バージョン</a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link p-1 p-md-2" id="info-tab" data-bs-toggle="tab" href="#info" role="tab" aria-controls="info"
        aria-selected="false">情報</a>
    </li>
  </ul>

  <div class="tab-content" id="myTabContent">
    <!-- 設定 -->
    <div class="tab-pane fade mt-3 mx-2 show active" id="settings" role="tabpanel" style="margin-bottom: 50px"
      aria-labelledby="settings-tab">
      <h5 class="">ルール設定</h5>

      <!-- ルール追加フォーム -->
      <div class="accordion mb-4" id="formAccordion">
        <div class="accordion-item" id="form-accordion-item">
          <h2 class="accordion-header" id="headingForm">
            <button class="accordion-button p-2 fs-6" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapseForm" aria-expanded="true" aria-controls="collapseForm"
              id="form-accordion-button">
              <span id="form-title">新規ルール追加</span>
            </button>
          </h2>
          <div id="collapseForm" class="accordion-collapse collapse show" aria-labelledby="headingForm"
            data-bs-parent="#formAccordion">
            <div class="accordion-body pt-1 px-3 pb-3">
              <input type="hidden" id="rule-id" />
              <small class="text-danger">* は必須項目です</small>
              <div class="mb-2">
                <label class="form-label small mb-1">カテゴリ</label>
                <select class="form-select form-select-sm" id="rule-category">
                  <option value="general">通常設定 (すべてのサイト)</option>
                  <option value="site">サイト別設定 (特定のドメイン等)</option>
                </select>
              </div>
              <div class="mb-2" id="site-pattern-container" style="display: none">
                <label class="form-label small mb-1 required">対象サイトのURL/ドメイン</label>
                <div class="input-group input-group-sm">
                  <input type="text" class="form-control form-control-sm" id="rule-site-pattern"
                    placeholder="例: teams.microsoft.com" required aria-required="true" />
                  <button class="btn btn-secondary" type="button" id="get-current-site-button"
                    title="現在のサイトを取得">現在のサイト</button>
                </div>
              </div>
              <div class="mb-1">
                <label class="form-label small mb-1">条件</label>
                <select class="form-select form-select-sm" id="rule-condition">
                  <option value="extension">拡張子 (例: pdf, zip)</option>
                  <option value="filename">ファイル名に含まれる文字列</option>
                  <option value="url">URLに含まれる文字列</option>
                </select>
              </div>
              <div class="mb-1">
                <label class="form-label small mb-1 required">パターン</label>
                <input type="text" class="form-control form-control-sm" id="rule-pattern"
                  placeholder="例: pdf / teams / report" required aria-required="true" />
              </div>
              <div class="mb-3">
                <label class="form-label small mb-1">保存先フォルダ</label>
                <input type="text" class="form-control form-control-sm" id="rule-folder"
                  placeholder="例: Documents/Work" />
                <small class="text-muted" style="font-size: 0.75rem">※ダウンロードフォルダからの相対パス</small>
              </div>

              <!-- オプションセクション -->
              <div class="border-top pt-2 mb-3">
                <h6 class="mb-1 small fw-bold">オプション</h6>

                <!-- ファイル名の上書きチェックボックス -->
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="rule-override-filename" />
                  <label class="form-check-label small" for="rule-override-filename">
                    ファイル名の上書き
                  </label>
                </div>

                <!-- リネームチェックボックス + 入力フィールド -->
                <div class="form-check mb-1">
                  <input class="form-check-input" type="checkbox" id="rule-rename" />
                  <label class="form-check-label small" for="rule-rename">
                    リネーム
                  </label>
                </div>
                <div class="ms-4" id="rule-rename-input-container" style="display: none;">
                  <input type="text" class="form-control form-control-sm" id="rule-rename-filename"
                    placeholder="例: [date]-[original] や backup-[original] など" />
                  <small class="text-muted" style="font-size: 0.75rem">利用可能: [original], [date], [time], [datetime], [ext]</small>
                </div>
              </div>

              <div class="d-flex gap-2">
                <button class="btn btn-primary btn-sm w-100" id="add-rule-button">ルールを追加</button>
                <button class="btn btn-outline-secondary btn-sm w-100" id="cancel-edit-button"
                  style="display: none">編集やめる</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- サイト別ルールリスト -->
      <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
        <h6 class="mb-0">サイト別ルール</h6>
        <button class="btn btn-outline-secondary btn-sm" id="toggle-site-sort-mode" title="並び替えモード">
          <i class="bi bi-arrow-down-up"></i> 並び替え
        </button>
      </div>
      <div id="site-rules-list" class="list-group mb-4">
        <!-- ここにJavaScriptでルールが追加されます -->
        <div class="text-muted small text-center p-2 border rounded">登録されたルールはありません</div>
      </div>

      <!-- 通常ルールリスト -->
      <div class="d-flex justify-content-between align-items-center mt-4 mb-2">
        <h6 class="mb-0">通常ルール</h6>
        <button class="btn btn-outline-secondary btn-sm" id="toggle-general-sort-mode" title="並び替えモード">
          <i class="bi bi-arrow-down-up"></i> 並び替え
        </button>
      </div>
      <div id="general-rules-list" class="list-group mb-4">
        <!-- ここにJavaScriptでルールが追加されます -->
        <div class="text-muted small text-center p-2 border rounded">登録されたルールはありません</div>
      </div>
    </div>

    <!-- 概要 -->
    <div class="tab-pane fade mt-2 mx-2" id="description" role="tabpanel" style="margin-bottom: 200px"
      aria-labelledby="description-tab">
      <div>
        <h5>概要</h5>
        <p class="my-1 fw-bold">説明:</p>
        <p>このChrome拡張機能を使えば，○○できます．</p>
        <p class="my-1 fw-bold">拡張機能の主な特徴:</p>
        <p class="mt-1">機能の説明を書く</p>
        <p class="my-1 fw-bold">注意点:</p>
        <p class="mt-1">注意点を書く</p>
      </div>
    </div>

    <!-- ドキュメント -->
    <div class="tab-pane fade mt-2 mx-2" id="document" role="tabpanel" style="margin-bottom: 200px"
      aria-labelledby="document-tab">
      <div class="accordion" id="accordion">
        <!-- 概要 -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#doc-overview"
              aria-expanded="true" aria-controls="doc-overview">概要</button>
          </h2>
          <div id="doc-overview" class="accordion-collapse collapse show" data-bs-parent="#accordion">
            <div class="accordion-body p-3">
              <p class="my-1 fw-bold">説明</p>
              <p>ダウンロードしたファイルの保存先を，あらかじめ設定したルールに基づいて自動的に振り分けることができる拡張機能です．</p>
              <p class="my-1 fw-bold">主な特徴</p>
              <div class="mt-1">
                <ul>
                  <li>ファイル名，URL，拡張子の3つの条件でルールを構成できます．</li>
                  <li>「通常設定」と「サイト別設定」を使い分けることが可能です．</li>
                  <li>一度設定すれば，ダウンロード時に自動でフォルダが指定されます．</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- チュートリアル -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#doc-tutorial" aria-expanded="false" aria-controls="doc-tutorial">
              チュートリアル
            </button>
          </h2>
          <div id="doc-tutorial" class="accordion-collapse collapse" data-bs-parent="#accordion">
            <div class="accordion-body p-3">
              <p class="mb-2 fw-bold">基本的なルールの作り方フロー</p>
              <div class="small">
                <ol>
                  <li class="mb-1"><strong>カテゴリの選択</strong>
                    <p class="mb-2">
                      全体のルールなら「通常設定」，特定のサイト専用なら「サイト別設定」を選びます．「サイト別」を選んだ場合は，対象となるサイトのURL（例：teams.microsoft.com）を入力します．
                    </p>
                  </li>

                  <li class="mb-1"><strong>条件とパターンの入力</strong>
                    <p class="mb-2">「拡張子」を選んで「pdf」と入力するなど，そのサイト内（または全体）でどのファイルを対象にするか指定します．</p>
                  </li>

                  <li class="mb-1"><strong>保存先の指定</strong>
                    <p class="mb-2">「Documents/Reports」のようにフォルダ名を入力します．多階層の指定も可能です．</p>
                  </li>

                  <li class="mb-1"><strong>ルールの登録と確認</strong>
                    <p class="mb-0">「ルールを追加」ボタンを押すと即座に有効になります．以降のダウンロードから自動振り分けが開始されます．</p>
                  </li>
                </ol>
              </div>
            </div>
          </div>
        </div>

        <!-- 用語・仕様について -->
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#doc-terms" aria-expanded="false" aria-controls="doc-terms">用語・仕様について</button>
          </h2>
          <div id="doc-terms" class="accordion-collapse collapse" data-bs-parent="#accordion">
            <div class="accordion-body p-3 small">
              <p class="mb-1 fw-bold">優先順位と並び替えの仕様</p>
              <ul class="mb-3">
                <li>まず「サイト別設定」を判定し，次に「通常設定」を判定します．</li>
                <li>カテゴリ内は「優先度: n」が小さい順に適用します．</li>
                <li>「並び替え」ボタンでハンドルが表示され，ドラッグした順序がそのまま保存されます．終わったらボタンをオフにするとハンドルが隠れます．</li>
                <li class="mb-0">例：通常設定に「pdf→PDF」，サイト別設定に「teams→Teams」がある場合，Teams からの PDF は Teams フォルダに保存されます．</li>
              </ul>

              <p class="mb-1 fw-bold">保存先フォルダ（相対パス）</p>
              <p>
                ブラウザ設定の「ダウンロード先」を起点としたパスです． <br />例：設定が「C:\Downloads」で，入力が「Work/Project」の場合
                <br />結果：「C:\Downloads\Work\Project\ファイル名」として保存されます．
              </p>

              <p class="mb-1 fw-bold">マッチング条件の例</p>
              <ul>
                <li><strong>拡張子：</strong>「jpg」や「zip」など． <br /><span class="text-muted">例：拡張子「docx」→「Word」フォルダへ．</span>
                </li>
                <li><strong>ファイル名：</strong>名前の一部． <br /><span class="text-muted">例：「領収書」→「Finance」フォルダへ．</span></li>
                <li><strong>URL：</strong>ダウンロード元のアドレス． <br /><span class="text-muted">例：「github.com」→「Code」フォルダへ．</span>
                </li>
              </ul>

              <p class="mb-1 fw-bold">ファイル名の上書き設定</p>
              <ul class="mb-3">
                <li>オン: 同名ファイルがあっても上書きします．</li>
                <li>オフ: ブラウザ標準の動作で「(1)」「(2)」のように連番を付けます．</li>
                <li>リネーム使用時も，上書きするかどうかはこの設定に従います．</li>
              </ul>

              <p class="mb-1 fw-bold">リネームとプレースホルダー</p>
              <p class="mb-1">「リネーム」をオンにするとテンプレート欄が出て，保存名を自由に組み立てられます．</p>
              <div class="table-responsive mb-2">
                <table class="table table-sm align-middle mb-0">
                  <thead>
                    <tr>
                      <th class="small">プレースホルダー</th>
                      <th class="small">意味</th>
                      <th class="small">フォーマット例</th>
                    </tr>
                  </thead>
                  <tbody class="small">
                    <tr>
                      <td>[original] / [filename]</td>
                      <td>元のファイル名（拡張子なし）</td>
                      <td>report</td>
                    </tr>
                    <tr>
                      <td>[ext]</td>
                      <td>拡張子</td>
                      <td>pdf</td>
                    </tr>
                    <tr>
                      <td>[date]</td>
                      <td>日付</td>
                      <td>20260117</td>
                    </tr>
                    <tr>
                      <td>[time]</td>
                      <td>時刻</td>
                      <td>142530</td>
                    </tr>
                    <tr>
                      <td>[datetime]</td>
                      <td>日付+時刻</td>
                      <td>20260117-142530</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <ul class="mb-3">
                <li>テンプレートに [ext] が無い場合は，元の拡張子を末尾に自動で付けます．</li>
                <li class="mb-0">例：元のファイル名「report.pdf」，テンプレート「[date]-[original]」→ 「20260117-report.pdf」</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 更新履歴 -->
    <div class="tab-pane fade mt-2 mx-2" id="version" role="tabpanel" style="margin-bottom: 200px"
      aria-labelledby="version-tab">
      <ul class="list-group list-group-flush">
        <h5 class="pt-3 ps-2 mb-2">更新履歴</h5>
        <li class="list-group-item">
          <strong>v1.1.0</strong>
          <span class="badge bg-primary">最新</span>
          <ul class="small mt-1">
            <li>カテゴリ内の優先度を明記（小さい順に適用）</li>
            <li>並び替えモードでドラッグして優先度変更</li>
            <li>ファイル名の上書き可否とリネーム（プレースホルダー対応）を追加</li>
          </ul>
        </li>
        <li class="list-group-item">
          <strong>v1.0.1</strong>
          <ul class="small mt-1">
            <li>「現在のサイト」取得機能の不具合を修正</li>
          </ul>
        </li>
        <li class="list-group-item">
          <strong>v1.0.0</strong>
          <ul class="small mt-1">
            <li>初回リリース</li>
          </ul>
        </li>
      </ul>
    </div>

    <!-- 詳細情報 -->
    <div class="tab-pane fade mt-2 mx-2" id="info" role="tabpanel" style="margin-bottom: 200px"
      aria-labelledby="info-tab">
      <ul class="list-group list-group-flush">
        <h5 class="pt-3 ps-2 mb-2">詳細</h5>

        <li class="list-group-item">
          <ul>
            <li>
              <a class="" href="https://chromewebstore.google.com/" id="store_link"> ストアページに移動 </a>
            </li>
            <li>
              <a href="" id="extension_link">この拡張機能を管理する</a>
            </li>
            <li>
              <a href="https://forms.gle/qkaaa2E49GQ5QKMT8" id="issue-link">問題を報告する</a>
            </li>
          </ul>
        </li>
        <li class="list-group-item">
          <p class="m-0">名前:</p>
          <p class="m-0" id="extension-name"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">説明:</p>

          <p class="m-0" id="extension-description"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">バージョン:</p>
          <p class="m-0" id="extension-version"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">ID:</p>
          <p class="m-0" id="extension-id"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">権限</p>
          <p class="m-0" id="permission-info"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">サイトへのアクセス:</p>
          <p class="m-0 py-1">アクセスしたウェブサイト上にある自分の全データの読み取りと変更をこの拡張機能に許可します．</p>
          <span id="site-access">Checking...</span>
        </li>
        <li class="list-group-item">
          <p class="m-0">シークレット モードでの実行を許可する:</p>
          <p class="m-0" id="incognito-enabled"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">言語:</p>
          <p class="m-0" id="language"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">提供元:</p>
          <p class="m-0" id="publisher-name"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">デベロッパー:</p>
          <p class="m-0" id="developer-name"></p>
        </li>
        <li class="list-group-item">
          <p class="m-0">GitHub:</p>
          <a class="m-0" id="github-link" href="#"></a>
        </li>
        <li class="list-group-item"></li>
      </ul>
      <div class="ps-0" style="margin-bottom: 180px">
        <h5 class="ps-1">プライバシー</h5>
        <p class="ps-3">お客様のデータを収集または使用しないことを表明しています．</p>
        <p class="ps-3">お客様のデータについて以下を宣言します．</p>
        <div class="m-2">
          <ul>
            <li>承認されている以外の用途で第三者に販売しないこと</li>
            <li>アイテムの中心機能と関係のない目的で使用または転送しないこと</li>
            <li>信用力を判断する目的または融資目的で使用または転送しないこと</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- 固定フッターとしての開閉パネル -->
  <div class="bg-light position-fixed bottom-0 end-0 border-top w-100" style="z-index: 2000">
    <!-- ドラッグしてサイズ変更 -->
    <div class="w-100 position-relative" id="resizer" style="cursor: n-resize; height: 5px"></div>
    <div>
      <!-- タブメニュー -->
      <div class="d-flex justify-content-between mx-1" id="tab-menu">
        <ul class="nav nav-underline px-2" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active p-0" id="settings-tab" data-bs-toggle="tab" href="#messagePanel" role="tab"
              aria-controls="settings " aria-selected="true">出力</a>
          </li>
        </ul>
        <div class="d-flex me-1">
          <!-- クリアボタン -->
          <button type="button" class="btn btn-sm btn-light p-0 me-1" id="clear-button" title="メッセージクリア"
            style="width: 20px; height: 20px; display: flex">
            <img src="../icons/list_clear.png" alt="message clear button" height="20" class="img-fluid" />
          </button>
          <!-- 最大化ボタン -->
          <button type="button" class="btn btn-sm btn-light p-0 me-1" id="maximize-button" title="最大化"
            style="width: 20px; height: 20px; display: block">
            <i class="bi bi-arrow-bar-up" style="font-size: 16px; line-height: 1"></i>
          </button>
          <!-- 最小化ボタン -->
          <button type="button" class="btn btn-sm btn-light p-0 me-1" id="minimize-button" title="最小化"
            style="width: 20px; height: 20px; display: none">
            <i class="bi bi-arrow-bar-down" style="font-size: 16px; line-height: 1"></i>
          </button>
          <!-- パネルの表示ボタン -->
          <button type="button" class="btn btn-sm p-0 btn-light" id="panel-button" title="パネルの表示"
            style="width: 20px; height: 20px; display: flex">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="-0.5 -0.5 16 16" fill="none" stroke="#000000"
              stroke-linecap="round" stroke-linejoin="round" id="Panel-Bottom-Open--Streamline-Lucide" height="16"
              width="16">
              <desc>Panel Bottom Open Streamline Icon: https://streamlinehq.com</desc>
              <path
                d="M3.125 1.875h8.75s1.25 0 1.25 1.25v8.75s0 1.25 -1.25 1.25H3.125s-1.25 0 -1.25 -1.25V3.125s0 -1.25 1.25 -1.25"
                stroke-width="1"></path>
              <path d="M1.875 9.375h11.25" stroke-width="1"></path>
              <path d="m5.625 6.25 1.875 -1.875 1.875 1.875" stroke-width="1"></path>
            </svg>
          </button>
          <!-- 閉じる -->
          <button type="button" class="btn btn-sm p-0 btn-light" id="close-button" title="閉じる"
            style="width: 20px; height: 20px; display: block">
            <i class="bi bi-x" style="font-size: 18px; line-height: 1"></i>
          </button>
        </div>
      </div>
      <!-- メッセージ -->
      <div class="tab-content" id="panel" style="display: block; height: 0px">
        <div id="messagePanel" class="bg-light text-dark p-1 overflow-auto tab-pane fade show active h-100"
          role="tabpanel" aria-labelledby="message-tab">
          <div id="message" style="border: 1px solid #ccc; padding: 10px; min-height: 100%; box-sizing: border-box">
          </div>
        </div>
        <div id="convertPanel" class="bg-light text-dark p-1 overflow-auto tab-pane fade h-100" role="tabpanel"
          aria-labelledby="convert-tab">
          <div id="convert" class="h-100" style="border: 1px solid #ccc; padding: 10px"></div>
        </div>
        <div id="infoPanel" class="bg-light text-dark p-1 overflow-auto tab-pane fade h-100" role="tabpanel"
          aria-labelledby="info-tab">
          <p>情報</p>
        </div>
      </div>
    </div>
  </div>

  <!-- スクリプトのリンク -->
  <script src="popup.js"></script>
</body>

</html>